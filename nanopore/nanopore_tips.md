# Nanopore関連のTips
- [全体を通しての注意事項](#全体を通しての注意事項)
- [必要な設備・試薬](#必要な設備試薬)
- [サンプル調整～Long DNA抽出](#サンプル調整long-dna抽出)
  - [サンプル調整](#サンプル調整)
  - [DNA抽出](#dna抽出)
  - [Short DNA除去](#short-dna除去)
- [ライブラリ調整～シーケンス](#ライブラリ調整シーケンス)
    - [ライブラリ調整](#ライブラリ調整)
    - [シーケンス](#シーケンス)
    - [フローセルの再利用](#フローセルの再利用)
- [ベースコール～アセンブル](#ベースコールアセンブル)
    - [ベースコール](#ベースコール)
    - [アセンブル](#アセンブル)
    - [アセンブル結果の確認](#アセンブル結果の確認)


## 全体を通しての注意事項
Nanoporeは長いDNAが必要な分、普通のDNAを扱う実験とは勝手が異なる。長いDNAは物理的に切れやすいため、専用の道具を使って丁寧に扱う意識を持つことが大事。また、開発されたばかりの手法であるため、常に最新の情報に気を付けること。試薬・関連ソフトも旧版と最新版で性能が全く異なることがある。特にソフトは毎月最新版が出ていないかチェックする。必要に応じて古いソフトから出力された結果を最新のソフトで解析しなおすこと。<br>Nanoporeの公式ソフトや公式プロトコルは製品を購入した人のみアクセス可能な専用サイトからダウンロードできる。ちょいちょい不親切なので、うまくいくまでやるという気持ちが大事。要は、
- 長いDNAはとにかく切れやすい。DNAの動きを想像して実験する。冷凍厳禁、ボルテックス厳禁、ピペッティングはゆっくり、遠心は必要最小限！！！
- 最新情報に注意する。
- 手順が煩雑＆クセが強いので、はじめの数回は失敗を覚悟して実験する。上手くいかなくてもあきらめない。

## 必要な設備・試薬
- Minion Starter Pack　#スターターと言いながら追加で下記の専用酵素が必要。
- NEBNext Companion Module for Oxford Nanopore Technologies Ligation Sequencing　#酵素3種セット。バラで買うと1回あたりで高くなる。
- Wide Boreのピペットチップ各サイズ　#先端の穴が大きいピペットチップ。長いDNAが引っかかって切れるのを抑制。
- Low Bindのチューブ（1.5mL）　#長いDNAがチューブ壁面に引っかかって切れるのを抑制。
- 0.2mLのPCRチューブ　#現時点でLow Bindが存在しないので、普通のを使う。
- 99.5%エタノール
- 70%エタノール　#99.5%エタノールから毎回新しく調整すること。古いと空中の水分を吸って薄まっている可能性がある。
- Nucrease Free Water　#MilliQ水でもOKだと思う。
- DNA磁気精製用のビーズ、マグネット（AMPure XP） #実験室に1.5mLチューブ対応のマグネットが無いため、0.2mL用を工夫しながら使う。
- アイスブロック
- ヒートブロック
- ピペット、ピペットチップ各サイズ
- 卓上遠心機
<br>
以下は必須ではないが、良い結果を出すためには必須。

- Long DNA抽出用のキット（NucleoBond HMW DNA kitなど）
- Short DNAを除去する用のキット（Short Read Eliminatorなど）
- Nanodrop、Qubit　#抽出したDNAの品質確認用
- 電気泳動関連設備　#抽出したDNAの長さ確認用
- 50Kbp付近にバンドが出る泳動用のラダー　#抽出したDNAの長さ確認用
- シェイカー　#研究室に無いので、手動で頑張る。
- GPGPU対応のGPU　#ベースコールが20倍速くなる

## サンプル調整～Long DNA抽出
Nanoporeは基本的に抽出されたDNAをそのままシーケンスするため、抽出されたDNAの質で下流の実験の質が決まる。<br>
サイズの大きいDNAの抽出にはMacherey-Nagel NucleoBond High Molecular Weight DNA Kitを利用しているが、同等のものなら何でもいいと思う。Nanobind 高分子ゲノムDNA抽出キットもよさそうだが、植物用のキットはあらかじめ核を抽出する必要があるため利用したことはない。ただ、昆虫ではいい結果が出ているようなので、植物以外だったら試す価値があるかも。<br>
全体の流れとしては、サンプル調整→DNA抽出→short DNA除去→ライブラリ調整へ。

### サンプル調整
ゲノム解読が目的の場合、なるべく純系に近く、他の種（細菌やカビなど）の混入DNAが少なくなるようなサンプルを利用する。
植物の場合、なるべく病害虫の痕跡が無い、汚染されてなさそうな部位を採集する。健康な植物であっても常在菌みたいなものがいるので、理想的には無菌培養された個体を利用する。多糖が多い部位（根、花弁など）だと抽出されるDNAの質・量が悪くなるので避ける。まずは葉から抽出することをオススメする。

### DNA抽出
植物の葉の場合、まず乳鉢ですり潰すことになるが、この際良くつぶすことでDNAの収量が上がる。これでもかというほどつぶすこと。<br>
NucleoBond High Molecular Weight DNA Kitを基本的にプロトコル通りに使う。ただし、次の3点を変更する。
- inputのサンプル量を3倍にする（バッファー量はそのまま）
- サンプルを温める時間を30分から3時間以上にする
- 抽出されたDNAを再溶解させる時間を、10分から1晩にする

50mLの遠沈管を使うので、対応する遠心機を借りる。<br>
抽出されたDNAは、電気泳動によって長いDNAを含むことを確認する。アガロース濃度を0.5%、泳動時間を30分程度にし、長いDNAに対応するラダーと一緒に流す。50Kbp以上のところに最も濃く、それ以下のところに薄くスメアが出るようになっていれば次の工程に進む。なっていなければ再抽出。<br>
抽出されたDNAはLow Bindチューブに入れて冷蔵保存可能。口にパラフィルムを巻いておくこと。少なくとも1年は長いままだった。冷凍保存すると融解する際にDNAが切れるので避ける。

### Short DNA除去
長いDNAが取れていることが確認できたら、短いDNAを取り除く処理を行う。CirculomicsのShort Read Eliminator XSをプロトコル通りに利用する。CirculomicsのShort Read Eliminatorは除去できるサイズの違う3種類があるが、DNA抽出に使えるサンプルが潤沢にあったり、かなり大きいDNAが取れるような試薬を使った場合以外はXSを使ったほうがいいと思う。DNAを扱うチューブはLow Bind、ピペットはWide Boreを使うこと。<br>
抽出されたDNAは泳動により断片化していないことを確認した後、QubitでDNA量を測定・記録しておく。DNAはLow Bindチューブに入れて冷蔵保存可能。口にパラフィルムを巻いておくこと。

## ライブラリ調整～シーケンス
DNAを扱うチューブはLow Bind、ピペットはWide Boreを使うこと。<br>
ライブラリ調整→シーケンス→必要に応じて再利用

### ライブラリ調整
ライブラリ調整は、DNA Repair→Adaptor Ligation→Priming & Loadingの3段階。各段階で得られる産物は冷蔵保存可能。Priming & Loadingの産物に関してはあまり長期保存しない方がよさそう。<br>
ライブラリ調整は基本的にプロトコルに従って行う。PCRせずにゲノムシーケンスを行う場合は、公式サイトからLigation Sequencingに対応するプロトコルをダウンロードしておく。<br>
DNA RepairのinputのDNA量は絶対量でおおよそ1000ngに調整する。調整には水を用い、0.2mLのチューブに入れておく。このチューブをそのままサンプル調整に利用することでDNAのロスを防ぐ。酵素が上手く混ざらないので、Wide Boreのピペットでゆっっっっっくりピペッティングする。<br>
Adaptor LigationにはDNA Repairで得られたDNA全量を利用する。DNAスタンダードは入れなくて良い。酵素が上手く混ざらないので、Wide Boreのピペットでゆっっっっっくりピペッティングする。<br>
DNA RepairとAdaptor Ligationが終わったらそれぞれQubitによりDNA量を定量しておくこと。<br>
Priming & Loadingには絶対量でおよそ100ngのDNAを用いる。Loading Beadsを利用すると植物の場合はスループットが悪くなる気がするので、代わりにLoading Bufferを増量する。<br>

### シーケンス
たまにMinKnowがMinIONを認識してくれないことがあるので、抜き差ししたりして頑張る。バージョンアップで認識しなくなることもあるので、その時はコミュニティの掲示板を見て対処法を探す（なかったらしばらく待つ）。<br>
フローセルをActivateしたら、1時間くらいおいて常温に戻したほうが良い結果が得られるらしい。<br>
シーケンサ部分に絶対に気泡が入らないように気を付ける。プロトコルを順守すること。サンプルをアプライする前にはWide Boreのピペットでゆっっっっっくりピペッティングする。<br>
出力はfast5とfastq形式を選択。fast5のほうが情報量が多く、後でベースコールソフトがアップデートされたときに再解析できる。fastqはfast basecallの出力なので精度が低いが、すぐに解析に利用できるので様子見用に使える。

### フローセルの再利用
Wash Kitを使うことでフローセルを再利用可能。植物の場合は2回くらいまでなら洗って再利用できる。昆虫や真菌の場合は（多糖が少ないため？）もっと再利用できるらしい。WashしたらPoreの状況を確認するが、Activateした方が正確な値が出る。1-2回目ならどうせシーケンスするのでActivateしておいてもいいかも。

## ベースコール～アセンブル
ベースコールにはそれなりの性能のCPU、RAMが必須。GPUもあった方が良い（ないと数か月単位で時間がかかる）。Linux推奨。WSLを利用する場合、GPUを認識させるのが少し手間だが、問題なく動く。<br>
全体の流れとしては、ベースコール→アセンブル→アセンブル結果の確認。

### ベースコール
計算が速いものの正確性に欠けるFast Basecallと、計算が遅いものの正確性の高いAccurate Basecallがある。前者は（設定をいじらなければ）シーケンスする際に出力されるfastqで、後者はfast5形式の出力から自分で計算させる。主なものにGuppyとBonitoがある。Bonitoはディープラーニングによるベースコーラーで、自前のデータでトレーニングすればGuppyよりやや良い結果が出るらしい（未利用）。以下Guppyについて基本的な利用法を記述する。

### アセンブル
アセンブルは総当たりで計算されるため、一般にメモリの使用量や、中間ファイルのサイズがデカいことが多い。さまざまなアセンブルソフトが出ているため、いろいろ試して自分のデータに合ったソフトを探すこと。Nanoporeはエラーが多いロングリードを出力するため、対応したソフトは限られる。まずはメモリ使用量の少ないFlye、速いが中間ファイルの出力が多いCanu、正確だが使いにくいなNECATあたりをとりあえず動かすのがいいと思う。以下、Flyeについて基本的な利用法を記述する。<br>


```
flye
```

### アセンブル結果の確認
リファレンスゲノムのないDeNovoアセンブリによってゲノムを再現した場合、そのゲノムがどの程度「正しい」かを把握するのは難しい。そこで、幾つかの指標を確認することでゲノムの完成度を推定する。完成度が低い場合はデータを追加するのが基本だが、ある程度データが集まると改善率が悪くなっていくので、目的に応じて費用対効果を考えること。ある程度データがあるならアセンブラやベースコーラを変える・アップデートするのも試す価値あり。<br>

#### アセンブルサイズ・N50など
Flyeの標準出力の一番下のセクションにアセンブルサイズ、カバレッジ、N50、コンティグ数、最も短い・長いコンティグの長さなどがかかれている。DNAの配列からk-mer解析によってゲノムサイズが推定できるので、アセンブルサイズを比較すれば完成度が大まかに判断可能。カバレッジは30以上あれば概ねOK（純系の場合はもっと低くてもOK）。N50、コンティグ数やコンティグ長などは基本的に大きければ大きいほど良く、先行研究などから目標値を決めると良い。ただし、ここにこだわりすぎても良くないので、研究の目的に応じてデータを追加するか判断する。

#### BUSCO
Benchmarking Universal Single-Copy Orthologsの略。ある分類群に保存的な遺伝子のリストに含まれる遺伝子が、インプットデータにどの程度含まれるかを計算することでゲノムの完成度を推定する方法。遺伝研のスパコンならSingularity経由で利用可能。理研の運営する[gVolante](https://gvolante.riken.jp/)なら手元のリソースを使わずに計算できるので便利。<br>
バージョンによって結果が変わるので注意。最新版はBUSCO v5で、データベースはOrthioDB v10。植物の場合はEmbryophyta（コケ-被子植物）、Liliopsida（単子葉類）、Eudicots（双子葉）などが利用可能。より狭いBrassicales、Fabalesなどもあるので、適した分類群を利用する。BUSCOが概ね90%以上（理想は95%以上）になっていれば、下流の解析が可能と考えて良いと思う。

#### RNA-seqのマッピング
ゲノムを決定したい種のRNA-seqデータを持っているのであれば、完成したゲノムにマッピングしてみると良い。遺伝子が十分再現されたゲノムにコンタミの少ないRNA-seqデータをマッピングすれば90％程度マッピングされるはず（根などコンタミの多い部位からのデータだと60%程度のことも）。
